<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0f">
<title>Properties</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUHJvcGVydGllcyIsInNob3J0X25hbWUiOiJQcm9wcyIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGEwYTBmIiwidGhlbWVfY29sb3IiOiIjMGEwYTBmIn0=">
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap');
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  :root{--bg:#0a0a0f;--surface:#141419;--surface2:#1c1c24;--surface3:#24242f;--border:#2a2a38;--text:#e8e6f0;--text2:#9896a8;--text3:#6b6980;--accent:#8b7cf6;--accent-glow:rgba(139,124,246,0.15);--green:#4ade80;--green-glow:rgba(74,222,128,0.12);--amber:#fbbf24;--amber-glow:rgba(251,191,36,0.12);--red:#f87171;--radius:14px;--safe-top:env(safe-area-inset-top,0px);--safe-bottom:env(safe-area-inset-bottom,0px)}
  body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
  .header{position:sticky;top:0;z-index:100;padding:calc(var(--safe-top) + 12px) 16px 12px;background:rgba(10,10,15,0.85);backdrop-filter:blur(20px) saturate(1.5);-webkit-backdrop-filter:blur(20px) saturate(1.5);border-bottom:1px solid var(--border)}
  .header-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .header h1{font-size:22px;font-weight:600;letter-spacing:-0.3px}
  .header .count{font-size:13px;color:var(--text3);font-weight:400}
  .icon-btn{width:38px;height:38px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text2);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s}
  .icon-btn:active{transform:scale(0.93);background:var(--surface2)}
  .search-wrap{position:relative}
  .search-wrap svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--text3);pointer-events:none}
  .search-input{width:100%;height:42px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text);padding:0 12px 0 40px;font-family:inherit;font-size:15px;outline:none;transition:border .2s}
  .search-input::placeholder{color:var(--text3)}
  .search-input:focus{border-color:var(--accent)}
  .filters{display:flex;gap:8px;padding:10px 16px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
  .filters::-webkit-scrollbar{display:none}
  .filter-chip{flex-shrink:0;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:500;border:1px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer;transition:all .15s;white-space:nowrap}
  .filter-chip:active{transform:scale(0.95)}
  .filter-chip.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .filter-chip.fc-current.active{background:var(--green);border-color:var(--green);color:#000}
  .filter-chip.fc-past.active{background:var(--amber);border-color:var(--amber);color:#000}
  .list{padding:8px 16px calc(var(--safe-bottom) + 80px)}
  .sdiv{display:flex;align-items:center;gap:10px;margin:18px 0 10px}
  .sdiv-label{font-size:12px;font-weight:600;letter-spacing:0.8px;text-transform:uppercase;white-space:nowrap}
  .sdiv-label.current{color:var(--green)}.sdiv-label.past{color:var(--amber)}
  .sdiv-line{flex:1;height:1px;background:var(--border)}
  .sdiv-count{font-size:11px;color:var(--text3)}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:10px;cursor:pointer;transition:all .15s;position:relative;overflow:hidden}
  .card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--accent);opacity:0;transition:opacity .2s}
  .card:active{transform:scale(0.985)}.card:active::before{opacity:1}
  .card.past-card{opacity:0.5}.card.past-card:active{opacity:0.75}
  .card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
  .card-name{font-size:16px;font-weight:600;letter-spacing:-0.2px;line-height:1.3}
  .card-beds{flex-shrink:0;background:var(--accent-glow);color:var(--accent);font-size:12px;font-weight:600;padding:3px 8px;border-radius:6px;white-space:nowrap}
  .card-sub{font-size:13px;color:var(--text2);margin-top:4px}
  .card-meta{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
  .meta-tag{font-size:12px;color:var(--text3);display:flex;align-items:center;gap:4px}
  .meta-tag svg{width:14px;height:14px}
  .detail-overlay{position:fixed;inset:0;z-index:200;background:var(--bg);transform:translateX(100%);transition:transform .3s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;-webkit-overflow-scrolling:touch}
  .detail-overlay.open{transform:translateX(0)}
  .detail-header{position:sticky;top:0;z-index:10;padding:calc(var(--safe-top) + 12px) 16px 12px;background:rgba(10,10,15,0.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border)}
  .back-btn{display:flex;align-items:center;gap:6px;background:none;border:none;color:var(--accent);font-family:inherit;font-size:15px;font-weight:500;cursor:pointer;padding:4px 0}
  .edit-btn{padding:7px 16px;border-radius:8px;font-family:inherit;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s;border:none}
  .edit-btn.edit{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
  .edit-btn.save{background:var(--accent);color:#fff}
  .edit-btn:active{transform:scale(0.95)}
  .detail-body{padding:16px 16px calc(var(--safe-bottom) + 32px)}
  .detail-title{font-size:22px;font-weight:600;letter-spacing:-0.3px;line-height:1.3;margin-bottom:4px}
  .detail-subtitle{font-size:14px;color:var(--text2);margin-bottom:6px}
  .status-badge{display:inline-flex;align-items:center;gap:6px;font-size:13px;font-weight:600;padding:5px 12px;border-radius:8px;margin-bottom:20px}
  .status-badge.current{background:var(--green-glow);color:var(--green)}
  .status-badge.past{background:var(--amber-glow);color:var(--amber)}
  .section{margin-bottom:24px}
  .section-label{font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--text3);margin-bottom:10px}
  .field{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border);min-height:46px;gap:12px}
  .field:last-child{border-bottom:none}
  .field-label{font-size:13px;color:var(--text2);flex-shrink:0;min-width:100px}
  .field-value{font-size:14px;font-weight:500;text-align:right;word-break:break-all;display:flex;align-items:center;gap:8px}
  .field-value a{color:var(--accent);text-decoration:none;font-size:13px}
  .copy-btn{width:30px;height:30px;border-radius:7px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);display:inline-flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all .15s}
  .copy-btn:active{transform:scale(0.9)}
  .copy-btn.copied{background:var(--green);color:#fff;border-color:var(--green)}
  .pill-yes{color:var(--green)}.pill-no{color:var(--text3)}
  .field-edit{width:100%;flex:1;text-align:right;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 10px;color:var(--text);font-family:inherit;font-size:14px;outline:none;transition:border .2s}
  .field-edit:focus{border-color:var(--accent)}
  .detail-actions{margin-top:32px;display:flex;flex-direction:column;gap:10px}
  .action-btn{width:100%;padding:14px;border-radius:12px;font-family:inherit;font-size:14px;font-weight:500;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:8px}
  .action-btn:active{transform:scale(0.98)}
  .action-btn.archive{background:var(--amber-glow);color:var(--amber);border:1px solid rgba(251,191,36,0.25)}
  .action-btn.restore{background:var(--green-glow);color:var(--green);border:1px solid rgba(74,222,128,0.25)}
  .action-btn.delete{background:rgba(248,113,113,0.06);color:var(--red);border:1px solid rgba(248,113,113,0.2)}
  .fab{position:fixed;bottom:calc(var(--safe-bottom) + 20px);right:20px;width:56px;height:56px;border-radius:16px;z-index:150;background:var(--accent);color:#fff;border:none;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 24px rgba(139,124,246,0.4);cursor:pointer;transition:all .15s}
  .fab:active{transform:scale(0.9)}
  .toast{position:fixed;bottom:calc(var(--safe-bottom) + 90px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface3);border:1px solid var(--border);color:var(--text);padding:10px 20px;border-radius:10px;font-size:14px;font-weight:500;opacity:0;transition:all .3s;pointer-events:none;z-index:300;white-space:nowrap}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
  .modal-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,0.6);display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px)}
  .modal-overlay.open{display:flex}
  .modal{background:var(--surface);border-radius:20px 20px 0 0;padding:24px 20px calc(var(--safe-bottom) + 24px);width:100%;max-width:500px;border:1px solid var(--border);border-bottom:none}
  .modal h3{font-size:18px;font-weight:600;margin-bottom:16px}
  .modal-btn{width:100%;padding:14px;border-radius:12px;border:none;font-family:inherit;font-size:15px;font-weight:500;cursor:pointer;margin-bottom:8px;transition:all .15s}
  .modal-btn:active{transform:scale(0.98)}
  .modal-btn.primary{background:var(--accent);color:#fff}
  .modal-btn.secondary{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
  .modal-btn.cancel{background:none;color:var(--text3)}
  .empty{text-align:center;padding:60px 20px;color:var(--text3)}
  .empty svg{margin-bottom:12px;opacity:0.4}
  .empty p{font-size:15px}
  ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
</style>
</head>
<body>
<div class="header">
  <div class="header-top">
    <div><h1>Properties</h1><span class="count" id="countLabel"></span></div>
    <div style="display:flex;gap:8px">
      <button class="icon-btn" id="exportBtn" title="Export"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 15h12M9 3v9M5 8l4 4 4-4"/></svg></button>
    </div>
  </div>
  <div class="search-wrap">
    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="8" cy="8" r="5"/><path d="m13 13 3 3"/></svg>
    <input class="search-input" id="searchInput" type="text" placeholder="Search properties..." autocomplete="off">
  </div>
</div>
<div class="filters" id="filters">
  <button class="filter-chip active" data-filter="all">All</button>
  <button class="filter-chip" data-filter="1">1 Bed</button>
  <button class="filter-chip" data-filter="2">2 Bed</button>
  <button class="filter-chip" data-filter="3">3 Bed</button>
  <button class="filter-chip" data-filter="4">4+ Bed</button>
  <button class="filter-chip fc-current" data-filter="current">Current</button>
  <button class="filter-chip fc-past" data-filter="past">Past</button>
</div>
<div class="list" id="propertyList"></div>
<button class="fab" id="addBtn" title="Add property"><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M12 5v14M5 12h14"/></svg></button>
<div class="detail-overlay" id="detailView">
  <div class="detail-header">
    <button class="back-btn" id="backBtn"><svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M15 4l-8 8 8 8"/></svg> Back</button>
    <button class="edit-btn edit" id="editToggle">Edit</button>
  </div>
  <div class="detail-body" id="detailBody"></div>
</div>
<div class="toast" id="toast"></div>
<div class="modal-overlay" id="exportModal">
  <div class="modal">
    <h3>Export Data</h3>
    <button class="modal-btn primary" id="exportJSON">Export as JSON</button>
    <button class="modal-btn secondary" id="exportCSV">Export as CSV</button>
    <button class="modal-btn cancel" id="exportCancel">Cancel</button>
  </div>
</div>
<script>

const SEED=[{"id": 1, "internalName": "Nelson Walk", "name": "Exclusive 3 bed 3bath Penthouse near Canary Wharf!", "closestStation": "Bromley by Bow", "lockboxCode": "", "emergencyLockboxCode": "", "address": "8 Nelson Walk, flat 24", "zipCode": "E3 3FG", "bedrooms": 3, "bathrooms": 3, "internetResponsibility": "No", "wifiName": "5402 Hyperoptic Fibre Broadband", "wifiPassword": "d\u00d7VudtAEaQ3e.", "floor": 5, "wheelchairAccess": "Yes", "elevator": "Yes", "balconyGarden": "Yes", "parking": "No", "concierge": "Yes", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-3-bed-3bath-penthouse-near-canary-wharf/", "airbnb": "airbnb.com/h/airlandlords-canary-wharf", "status": "current"}, {"id": 2, "internalName": "Devon's Road", "name": "Devons Road", "closestStation": "Bromley by Bow", "lockboxCode": "", "emergencyLockboxCode": "", "address": "41 Devons Road, flat 9", "zipCode": "E3 3BF", "bedrooms": 2, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "34F0 Hyperoptic 1Gb Fibre 5Ghz", "wifiPassword": "kE7sY2yDAzht", "floor": 4, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "Yes", "parking": "No", "concierge": "Yes", "corporateluxe": "https://corporateluxe.co.uk/product/charming-2-bedroom-flat-in-bromley-by-bow/", "airbnb": "", "status": "current"}, {"id": 3, "internalName": "Dalston Junction", "name": "Exclusive 4 Bedroom House in the Heart of Hackney!", "closestStation": "Dalston Junction", "lockboxCode": "", "emergencyLockboxCode": "", "address": "108 Tottenham Road", "zipCode": "N1 4DP", "bedrooms": 4, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "VM6116584", "wifiPassword": "6kvhkkvNmwc3", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No!", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-4-bedroom-house-in-the-heart-of-hackney/", "airbnb": "", "status": "current"}, {"id": 4, "internalName": "Loudoun Road", "name": "Exclusive 1 bed 1 bath in St John's Wood", "closestStation": "Swiss Cottage", "lockboxCode": "", "emergencyLockboxCode": "", "address": "152 Loudoun Road", "zipCode": "NW8 0DH", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "BT-W7C23Q", "wifiPassword": "v3R4HxqAxf3PHd", "floor": 2, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-1-bed-1-bath-in-st-johns-wood/", "airbnb": "airbnb.com/h/airlandlords-st-johns-wood", "status": "current"}, {"id": 5, "internalName": "Sandringham Flat", "name": "Exclusive 2-Bedroom Flat in Leicester Square", "closestStation": "Leicester Square Station", "lockboxCode": "", "emergencyLockboxCode": "", "address": "117 Sandringham Flats", "zipCode": "WC2H 0BN", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "CommunityFibre10Gb_C6CB0", "wifiPassword": "v8tmjutqg7", "floor": 2, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2-bedroom-flat-in-leicester-square/", "airbnb": "", "status": "current"}, {"id": 6, "internalName": "Adelaide Road", "name": "Exclusive 2Bed 2Bath Flat in Swiss Cottage", "closestStation": "Swiss Cottage", "lockboxCode": "", "emergencyLockboxCode": "", "address": "183 Adelaide Road", "zipCode": "NW3 3NN", "bedrooms": 2, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "BT-38C2PK", "wifiPassword": "vuKPaVhqN4kXvX", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "Yes", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2bed-2bath-flat-in-swiss-cottage/", "airbnb": "airbnb.com/h/airlandlords-swiss-cottage", "status": "current"}, {"id": 7, "internalName": "Agnes Road", "name": "Fantastic 2 bedroom Flat", "closestStation": "Acton Central", "lockboxCode": "", "emergencyLockboxCode": "", "address": "8 Agnes Road", "zipCode": "W3 7RE", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "4GEE-WIFI-1336-2.4GHz", "wifiPassword": "4XqEh34fpEYW", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/%D1%81%D0%B5ntral-2-bedroom-flat-in-acton-central/", "airbnb": "", "status": "current"}, {"id": 8, "internalName": "Hackney / Montague Road", "name": "Hackney Exclusive", "closestStation": "Hackney Downs", "lockboxCode": "2023", "emergencyLockboxCode": "1984", "address": "21A Montague Road", "zipCode": "E8 2HN", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "VM9235601", "wifiPassword": "hzsr3HnTjzm4", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-1-bedroom-apartment-in-hackney/", "airbnb": "", "status": "current"}, {"id": 9, "internalName": "Faraday House", "name": "Modern 1 bedroom flat in the Heart of Battersea", "closestStation": "Battersea Power Station", "lockboxCode": "", "emergencyLockboxCode": "", "address": "10 Faraday House, Aurora Gardens", "zipCode": "SW11 8ED", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "EE-99MPKF", "wifiPassword": "CtNRidGqt4AyUm4f", "floor": 4, "wheelchairAccess": "Yes", "elevator": "Yes", "balconyGarden": "Yes", "parking": "No", "concierge": "Yes", "corporateluxe": "https://corporateluxe.co.uk/product/modern-1-bedroom-flat-in-the-heart-of-battersea/", "airbnb": "airbnb.com/h/airlandlords-battersea", "status": "current"}, {"id": 10, "internalName": "Dolben Court", "name": "Pimlico Station 2 Bedroom Flat near Buckingham Palace", "closestStation": "Pimlico Station", "lockboxCode": "1986", "emergencyLockboxCode": "1020", "address": "Dolben Court, flat 25", "zipCode": "SW1P 4BB", "bedrooms": 2, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "Hyperoptic Fibre OCAC", "wifiPassword": "RtuXyhu4DX3Y47", "floor": 2, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "Yes", "parking": "No", "concierge": "Yes", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2-bedroom-flat-near-buckingham-palace/", "airbnb": "airbnb.com/h/airlandlords-buckingham-palace", "status": "current"}, {"id": 11, "internalName": "Richmond", "name": "Richmond Superb", "closestStation": "Richmond Station", "lockboxCode": "6869", "emergencyLockboxCode": "3010", "address": "3b George Street", "zipCode": "TW9 1JY", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "PLUSNET-CZ6M", "wifiPassword": "bdafb7c83d", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/richmond-flat/", "airbnb": "airbnb.com/h/airlandlords-richmond", "status": "current"}, {"id": 12, "internalName": "Russell Square", "name": "Exceptional 4 bedroom apartment in Russell Square!", "closestStation": "Russell Square", "lockboxCode": "3256", "emergencyLockboxCode": "B3957", "address": "8 Tavistock Place", "zipCode": "WC1H 9RD", "bedrooms": 4, "bathrooms": 1, "internetResponsibility": "Yes", "wifiName": "4G-WIFI-MWFX-2.4GHZ", "wifiPassword": "TpJtxAwnaeE7", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-4-bedroom-apartment-in-russell-square/", "airbnb": "airbnb.com/h/airlandlords-russell-square", "status": "current"}, {"id": 13, "internalName": "Uxbridge Road", "name": "Fantastic 2 bedroom Flat near Westfield Shopping!", "closestStation": "Shepherds Bush", "lockboxCode": "", "emergencyLockboxCode": "", "address": "157 Uxbridge Road", "zipCode": "W12 9RB", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "TP-Link_4FFE", "wifiPassword": "63301751", "floor": 2, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/fabolous-2-bedroom-flat-near-westfield-shopping/", "airbnb": "", "status": "current"}, {"id": 14, "internalName": "Edward Road", "name": "Walthamstow Unique", "closestStation": "Walthamstow", "lockboxCode": "2659", "emergencyLockboxCode": "1894", "address": "239 Edward Road", "zipCode": "E17 6NU", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "Loukali", "wifiPassword": "RodakinoPeristeres18", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/unique-2-bedroom-flat-in-heart-of-walthamstow/", "airbnb": "airbnb.com/h/airlandlords-walthamstow", "status": "current"}, {"id": 15, "internalName": "Woodside Avenue", "name": "Charming Modern Chic Pad", "closestStation": "East Finchley", "lockboxCode": "B2371", "emergencyLockboxCode": "", "address": "14 Woodside Avenue", "zipCode": "N6 4SS", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "TP-Link_08EF_5G", "wifiPassword": "68029333", "floor": "Ground", "wheelchairAccess": "Yes", "elevator": "No", "balconyGarden": "Yes", "parking": "Yes", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/charming-modern-chic-pad-summer-house/", "airbnb": "", "status": "current"}, {"id": 16, "internalName": "Junction Place", "name": "Exceptional 4 bedroom House Paddington Station!", "closestStation": "Paddington", "lockboxCode": "1981", "emergencyLockboxCode": "", "address": "1 Junction Place", "zipCode": "W2 1RG", "bedrooms": 4, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "VM8338909", "wifiPassword": "yygeunfcD9zjexVn", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "", "airbnb": "airbnb.com/h/airlandlords-paddington-station", "status": "current"}, {"id": 17, "internalName": "Wimborne Mansions", "name": "3-Bedroom Flat in Belsize Park\u2013Families & Business", "closestStation": "Belsize Park", "lockboxCode": "1981", "emergencyLockboxCode": "1984", "address": "11 Glenloch Road", "zipCode": "NW3 4DJ", "bedrooms": 3, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "SKY7RUJ1", "wifiPassword": "up1NI2A3nuTk", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/stylish-3-bedroom-flat-in-belsize-park-perfect-for-families-business-trips/", "airbnb": "airbnb.com/h/airlandlords-belsize-park", "status": "current"}, {"id": 18, "internalName": "Myddleton Avenue", "name": "Exclusive 3 bedroom House near Manor House!", "closestStation": "Finsbury Park", "lockboxCode": "", "emergencyLockboxCode": "", "address": "74 Myddleton Avenue", "zipCode": "N4 2FH", "bedrooms": 3, "bathrooms": 2, "internetResponsibility": "No", "wifiName": "", "wifiPassword": "", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "", "airbnb": "airbnb.com/h/airlandlords-manor-house", "status": "current"}, {"id": 19, "internalName": "Odhams Walk", "name": "Exclusive 1 Bedroom Flat in Covent Garden", "closestStation": "Covent Garden", "lockboxCode": "", "emergencyLockboxCode": "", "address": "38 Odhams Walk", "zipCode": "WC2H 9SB", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "", "wifiPassword": "", "floor": 1, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "", "airbnb": "airbnb.com/h/airlandlords-covent-garden", "status": "current"}, {"id": 20, "internalName": "Kingston / Wheatfield Way", "name": "Exclusive  3 Bedroom Flat in Kingston Town!", "closestStation": "Kingston", "lockboxCode": "3245", "emergencyLockboxCode": "1985", "address": "12B Wheatfield Way", "zipCode": "KT1 2QS", "bedrooms": 3, "bathrooms": 1, "internetResponsibility": "Yes", "wifiName": "EE-99MPKF", "wifiPassword": "CtNRidGqt4AyUm4f", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-3-bedroom-flat-in-kingston-town/", "airbnb": "airbnb.com/h/airlandlords-kingston-town", "status": "current"}, {"id": 21, "internalName": "Waldeck Road - 58E", "name": "Apt1 Exclusive 1Bed Flat Chiswick Business Park!", "closestStation": "Turnham Green, Chiswick Park", "lockboxCode": "2131", "emergencyLockboxCode": "2974", "address": "58E Waldeck Road", "zipCode": "W4 3NP", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "gigacube-FF6A09", "wifiPassword": "3jQmytTmy5326858", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-1bedroom-flat-chiswick-business-park/", "airbnb": "airbnb.com/h/airlandlords-chiswick-1", "status": "current"}, {"id": 22, "internalName": "Waldeck Road - 58B", "name": "Apt2 Exclusive 1Bed Flat Chiswick Business Park!", "closestStation": "Turnham Green, Chiswick Park", "lockboxCode": "1121", "emergencyLockboxCode": "3221", "address": "58B Waldeck Road", "zipCode": "W4 3NP", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "gigacube-FF6A1E", "wifiPassword": "8yLj294jr32y7525", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/apt2-exclusive-1bed-flat-chiswick-business-park/", "airbnb": "airbnb.com/h/airlandlords-chiswick-2", "status": "current"}, {"id": 23, "internalName": "Hugh Street", "name": "Exclusive 1 bedroom Flat near Victoria Station", "closestStation": "Victoria Station", "lockboxCode": "9816", "emergencyLockboxCode": "1213", "address": "6 Hugh Street", "zipCode": "SW1V 1RP", "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "", "wifiPassword": "", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-1-bedroom-flat-near-victoria-station/", "airbnb": "airbnb.com/h/airlandlords-victoria-station", "status": "current"}, {"id": 24, "internalName": "Baddeley House", "name": "Exclusive 2 Bedroom Flat near Vauxhall Station!", "closestStation": "Vauxhall Station", "lockboxCode": "2208", "emergencyLockboxCode": "1985", "address": "Baddeley House Vauxhall Street ", "zipCode": "SE11 5NJ", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "Yes", "wifiName": "TP-Link_4FF", "wifiPassword": "63301751", "floor": 2, "wheelchairAccess": "No", "elevator": "Yes", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "", "airbnb": "", "status": "current"}, {"id": 25, "internalName": "Pilot Resedence", "name": "Central Baku Apartment - Old City & Boulevard", "closestStation": "Icherisheher Station", "lockboxCode": "-", "emergencyLockboxCode": "-", "address": "7 Leopold and Mstislav Rostropovichler, Baku, Azerbaijan", "zipCode": 1000.0, "bedrooms": 1, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "Pilot", "wifiPassword": "557038811", "floor": 3, "wheelchairAccess": "Yes", "elevator": "Yes", "balconyGarden": "Yes", "parking": "Street paid parking", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/baku-modern-central-baku-modern-central-baku-apartment-near-the-old-city-boulevard/", "airbnb": "", "status": "current"}, {"id": 26, "internalName": "Barons Court", "name": "Exclusive 2 Bedroom Flat near Barons Court!", "closestStation": "Barons Court", "lockboxCode": "9078", "emergencyLockboxCode": "", "address": "28D Greyhound Rd", "zipCode": "W6 8NX", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "Three_990D", "wifiPassword": "BqM#3QyA43", "floor": "2026-02-02 00:00:00", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2-bedroom-flat-near-barons-court/", "airbnb": "", "status": "current"}, {"id": 27, "internalName": "Holland Park", "name": "Exclusive 2 Bedroom Flat in Holland Park!", "closestStation": "Holland Park", "lockboxCode": "1950A", "emergencyLockboxCode": "O702", "address": "168 Holland Park Avenue", "zipCode": "W11 4UH", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "BT-H9AW9W", "wifiPassword": "hFuUTc3TDvXYb7", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/4885/", "airbnb": "airbnb.com/h/airlandlords-holland-park", "status": "current"}, {"id": 28, "internalName": "Brixton ", "name": "Exclusive 1 bedroom flat near Brixton Station!", "closestStation": "Brixton Station", "lockboxCode": "A1345", "emergencyLockboxCode": "O246", "address": "54B Bellefields Rd", "zipCode": "SW9 9UQ", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "TP-Link_3D5C", "wifiPassword": "93746212", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-1-bedroom-flat-near-brixton-station/", "airbnb": "", "status": "current"}, {"id": 29, "internalName": "Brendon Street / Paddington", "name": "Exclusive 3bedroom House near Paddington Station!", "closestStation": "Paddington Station", "lockboxCode": "1345A", "emergencyLockboxCode": "2578", "address": "8 Brendon Street", "zipCode": "W1H 5HE", "bedrooms": 3, "bathrooms": 3, "internetResponsibility": "No", "wifiName": "Home.", "wifiPassword": "55515551", "floor": "Ground", "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-3bedroom-house-near-paddington-station/", "airbnb": "", "status": "current"}, {"id": 30, "internalName": "Coldharbour Lane", "name": "Exclusive 2Bedroom Flat near Loughborough Junction", "closestStation": "Brixton Station", "lockboxCode": "1157", "emergencyLockboxCode": "1985", "address": "252a Coldharbour Lane", "zipCode": "SW9 8SE", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "Yes", "wifiName": "SSID(5G) ALHN-7C80", "wifiPassword": "fp8kuAzagt", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "Yes", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2bedroom-flat-near-loughborough-junction/", "airbnb": "airbnb.com/h/airlandlords-loughborough-junction", "status": "current"}, {"id": 31, "internalName": "Harvist Road / Queens Park", "name": "Modern 2 Bedroom Flat in Queens Park!", "closestStation": "Queens Park", "lockboxCode": "1805", "emergencyLockboxCode": "2131", "address": "21C Harvist Road", "zipCode": "NW6 6EU", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "EE-28QRXC", "wifiPassword": "aRMEDA4yayr9XCvH", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "No", "concierge": "No", "corporateluxe": "https://corporateluxe.co.uk/product/exclusive-2-bedroom-flat-in-queens-park/", "airbnb": "airbnb.com/h/airlandlords-queens-park", "status": "current"}, {"id": 32, "internalName": "Castle Street / Reading", "name": "Exclusive 2 bedroom House in the Heart of Reading!", "closestStation": "Reading Station", "lockboxCode": "2915", "emergencyLockboxCode": "1985", "address": "37A Castle Street", "zipCode": "RG1 7SB", "bedrooms": 2, "bathrooms": 1, "internetResponsibility": "No", "wifiName": "HUAWEI_B320_FB1D", "wifiPassword": "RAb232Gn2YH", "floor": 1, "wheelchairAccess": "No", "elevator": "No", "balconyGarden": "No", "parking": "Paid car park", "concierge": "No", "corporateluxe": "", "airbnb": "airbnb.com/h/airlandlords-castle-street", "status": "current"}];
const DB='corporateluxe_props_v2';
const FIELDS=[
  {key:'internalName',label:'Internal Name',section:'info',copyable:false},
  {key:'name',label:'Listing Name',section:'info',copyable:false},
  {key:'address',label:'Address',section:'location',copyable:true},
  {key:'zipCode',label:'Postcode',section:'location',copyable:true},
  {key:'closestStation',label:'Nearest Station',section:'location',copyable:false},
  {key:'floor',label:'Floor',section:'location',copyable:false},
  {key:'bedrooms',label:'Bedrooms',section:'details',copyable:false},
  {key:'bathrooms',label:'Bathrooms',section:'details',copyable:false},
  {key:'lockboxCode',label:'Lockbox Code',section:'access',copyable:true},
  {key:'emergencyLockboxCode',label:'Emergency Code',section:'access',copyable:true},
  {key:'wifiName',label:'Wi-Fi SSID',section:'wifi',copyable:true},
  {key:'wifiPassword',label:'Wi-Fi Password',section:'wifi',copyable:true},
  {key:'internetResponsibility',label:'Internet Resp.',section:'wifi',copyable:false},
  {key:'wheelchairAccess',label:'Wheelchair',section:'amenities',copyable:false},
  {key:'elevator',label:'Elevator / Lift',section:'amenities',copyable:false},
  {key:'balconyGarden',label:'Balcony / Garden',section:'amenities',copyable:false},
  {key:'parking',label:'Parking',section:'amenities',copyable:false},
  {key:'concierge',label:'Concierge',section:'amenities',copyable:false},
  {key:'corporateluxe',label:'CorporateLuxe',section:'links',copyable:false,isLink:true},
  {key:'airbnb',label:'Airbnb',section:'links',copyable:false,isLink:true},
];
const SECS={info:'Property Info',location:'Location',details:'Details',access:'Access Codes',wifi:'Wi-Fi',amenities:'Amenities',links:'Links'};

let props=[],curFilter='all',query='',editId=null,editing=false;

function init(){ load(); render(); bind(); }

function load(){
  try {
    const s=localStorage.getItem(DB);
    if(s){ props=JSON.parse(s); props.forEach(p=>{ if(!p.status) p.status='current'; }); }
    else { props=JSON.parse(JSON.stringify(SEED)); save(); }
  } catch(e){ props=JSON.parse(JSON.stringify(SEED)); }
}

function save(){ localStorage.setItem(DB,JSON.stringify(props)); }

function esc(s){ const d=document.createElement('div'); d.textContent=String(s||''); return d.innerHTML; }
function escA(s){ return String(s||'').replace(/"/g,'&quot;').replace(/</g,'&lt;'); }

function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2000);
}

function getList(){
  let l=props;
  if(curFilter==='current') l=l.filter(p=>p.status==='current');
  else if(curFilter==='past') l=l.filter(p=>p.status==='past');
  else if(curFilter!=='all'){ const n=parseInt(curFilter); l=n===4?l.filter(p=>parseInt(p.bedrooms)>=4):l.filter(p=>parseInt(p.bedrooms)===n); }
  if(query){ const q=query.toLowerCase(); l=l.filter(p=>(p.internalName||'').toLowerCase().includes(q)||(p.name||'').toLowerCase().includes(q)||(p.closestStation||'').toLowerCase().includes(q)||(p.address||'').toLowerCase().includes(q)||(p.zipCode||'').toLowerCase().includes(q)); }
  return l;
}

function render(){
  const list=getList(), el=document.getElementById('propertyList');
  const cur=list.filter(p=>p.status==='current'), past=list.filter(p=>p.status==='past');
  document.getElementById('countLabel').textContent=list.length+' propert'+(list.length===1?'y':'ies');

  if(!list.length){ el.innerHTML='<div class="empty"><svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="6" y="10" width="36" height="28" rx="3"/><path d="M6 18h36M18 10v8"/></svg><p>No properties found</p></div>'; return; }

  let h='';
  const grouped = curFilter==='all'||['1','2','3','4'].includes(curFilter);

  if(grouped && cur.length>0){
    if(past.length>0) h+='<div class="sdiv"><span class="sdiv-label current">Current Properties</span><span class="sdiv-line"></span><span class="sdiv-count">'+cur.length+'</span></div>';
    h+=cur.map(p=>mkCard(p,false)).join('');
  }
  if(grouped && past.length>0){
    h+='<div class="sdiv"><span class="sdiv-label past">Past Properties</span><span class="sdiv-line"></span><span class="sdiv-count">'+past.length+'</span></div>';
    h+=past.map(p=>mkCard(p,true)).join('');
  }
  if(!grouped){ h+=list.map(p=>mkCard(p,p.status==='past')).join(''); }

  el.innerHTML=h;
}

function mkCard(p,dim){
  const lk=p.lockboxCode&&p.lockboxCode!=='-'&&p.lockboxCode!=='';
  const wf=!!p.wifiName;
  return '<div class="card'+(dim?' past-card':'')+'" data-id="'+p.id+'">'
    +'<div class="card-header"><div class="card-name">'+esc(p.internalName)+'</div>'
    +'<div class="card-beds">'+p.bedrooms+' bed &middot; '+p.bathrooms+' bath</div></div>'
    +'<div class="card-sub">'+esc(p.address)+', '+esc(p.zipCode)+'</div>'
    +'<div class="card-meta">'
    +'<span class="meta-tag"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg> '+esc(p.closestStation)+'</span>'
    +(lk?'<span class="meta-tag"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg> Lockbox</span>':'')
    +(wf?'<span class="meta-tag"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01"/></svg> Wi-Fi</span>':'')
    +(dim?'<span class="meta-tag" style="color:var(--amber)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Past</span>':'')
    +'</div></div>';
}

function openDetail(id){
  const p=props.find(x=>x.id===id); if(!p) return;
  editId=id; editing=false;
  renderDetail(p);
  document.getElementById('detailView').classList.add('open');
  document.getElementById('editToggle').textContent='Edit';
  document.getElementById('editToggle').className='edit-btn edit';
}

function closeDetail(){
  document.getElementById('detailView').classList.remove('open');
  editId=null; editing=false;
}

function renderDetail(p){
  const body=document.getElementById('detailBody');
  const isCur=p.status==='current';
  let h='<div class="detail-title">'+esc(p.internalName)+'</div>'
    +'<div class="detail-subtitle">'+esc(p.name)+'</div>'
    +'<div class="status-badge '+(isCur?'current':'past')+'">'
    +(isCur?'&#10003; Current Property':'&#9201; Past Property')+'</div>';

  let curSec='';
  FIELDS.forEach(f=>{
    if(f.section!==curSec){
      if(curSec) h+='</div>';
      curSec=f.section;
      h+='<div class="section"><div class="section-label">'+SECS[f.section]+'</div>';
    }
    const val=String(p[f.key]||'');
    if(editing){
      h+='<div class="field"><div class="field-label">'+f.label+'</div>'
        +'<input class="field-edit" data-key="'+f.key+'" value="'+escA(val)+'"></div>';
    } else {
      let vhtml='';
      if(f.isLink && val){
        const url=val.startsWith('http')?val:'https://'+val;
        vhtml='<a href="'+escA(url)+'" target="_blank" rel="noopener">Open &#8599;</a>';
      } else if(val.toLowerCase()==='yes'){
        vhtml='<span class="pill-yes">Yes &#10003;</span>';
      } else if(val.toLowerCase()==='no'||val.toLowerCase()==='no!'){
        vhtml='<span class="pill-no">No</span>';
      } else {
        vhtml=esc(val)||'<span style="color:var(--text3)">&mdash;</span>';
      }
      const cbtn=(f.copyable&&val)?'<button class="copy-btn" data-copy="'+escA(val)+'" title="Copy"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="5" y="5" width="8" height="8" rx="1.5"/><path d="M5 9H3.5A1.5 1.5 0 012 7.5v-5A1.5 1.5 0 013.5 1h5A1.5 1.5 0 0110 2.5V5"/></svg></button>':'';
      h+='<div class="field"><div class="field-label">'+f.label+'</div><div class="field-value">'+vhtml+cbtn+'</div></div>';
    }
  });
  h+='</div>';

  if(!editing){
    h+='<div class="detail-actions">';
    if(isCur){
      h+='<button class="action-btn archive" data-id="'+p.id+'"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="14" height="4" rx="1"/><path d="M2 7h14v7a2 2 0 01-2 2H4a2 2 0 01-2-2V7zM7 11h4"/></svg> Move to Past Properties</button>';
    } else {
      h+='<button class="action-btn restore" data-id="'+p.id+'"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 100-12l-3 3"/></svg> Restore to Current Properties</button>';
    }
    h+='<button class="action-btn delete" data-id="'+p.id+'"><svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h12M5 6V4a1 1 0 011-1h6a1 1 0 011 1v2M8 9v5M10 9v5"/><path d="M4 6l1 10a1 1 0 001 1h6a1 1 0 001-1l1-10"/></svg> Delete Permanently</button>';
    h+='</div>';
  }

  body.innerHTML=h;
}

function saveEdits(){
  const p=props.find(x=>x.id===editId); if(!p) return;
  document.querySelectorAll('.field-edit').forEach(i=>{ p[i.dataset.key]=i.value; });
  save(); editing=false; renderDetail(p); render();
  document.getElementById('editToggle').textContent='Edit';
  document.getElementById('editToggle').className='edit-btn edit';
  toast('Changes saved');
}

function archiveProp(id){
  const p=props.find(x=>x.id===id); if(!p) return;
  p.status='past'; save(); renderDetail(p); render();
  toast('Moved to past properties');
}

function restoreProp(id){
  const p=props.find(x=>x.id===id); if(!p) return;
  p.status='current'; save(); renderDetail(p); render();
  toast('Restored to current properties');
}

function addProp(){
  const mx=props.reduce((m,p)=>Math.max(m,p.id),0);
  const np={id:mx+1,status:'current'};
  FIELDS.forEach(f=>np[f.key]='');
  np.internalName='New Property'; np.bedrooms=1; np.bathrooms=1;
  props.unshift(np); save(); render(); openDetail(np.id);
  editing=true; renderDetail(np);
  document.getElementById('editToggle').textContent='Save';
  document.getElementById('editToggle').className='edit-btn save';
  toast('New property added');
}

function delProp(id){
  if(!confirm('Delete this property permanently?')) return;
  props=props.filter(p=>p.id!==id); save(); closeDetail(); render();
  toast('Property deleted');
}

function copyText(text,btn){
  navigator.clipboard.writeText(text).then(()=>{
    btn.classList.add('copied'); setTimeout(()=>btn.classList.remove('copied'),1200);
    toast('Copied!');
  }).catch(()=>{
    const ta=document.createElement('textarea'); ta.value=text;
    document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    btn.classList.add('copied'); setTimeout(()=>btn.classList.remove('copied'),1200);
    toast('Copied!');
  });
}

function exportJSON(){
  const b=new Blob([JSON.stringify(props,null,2)],{type:'application/json'});
  dl(b,'properties.json'); closeModal();
}

function exportCSV(){
  const hd=['Status',...FIELDS.map(f=>f.label)];
  const rows=props.map(p=>{
    return [p.status,...FIELDS.map(f=>{
      const v=String(p[f.key]||'');
      return v.includes(',')||v.includes('"')?'"'+v.replace(/"/g,'""')+'"':v;
    })].join(',');
  });
  const csv=[hd.join(','),...rows].join('\n');
  dl(new Blob([csv],{type:'text/csv'}),'properties.csv'); closeModal();
}

function dl(blob,name){
  const u=URL.createObjectURL(blob),a=document.createElement('a');
  a.href=u; a.download=name; document.body.appendChild(a); a.click();
  document.body.removeChild(a); URL.revokeObjectURL(u); toast('Exported!');
}

function closeModal(){ document.getElementById('exportModal').classList.remove('open'); }

function bind(){
  document.getElementById('searchInput').addEventListener('input',e=>{ query=e.target.value; render(); });

  document.getElementById('filters').addEventListener('click',e=>{
    const c=e.target.closest('.filter-chip'); if(!c) return;
    document.querySelectorAll('.filter-chip').forEach(x=>x.classList.remove('active'));
    c.classList.add('active'); curFilter=c.dataset.filter; render();
  });

  document.getElementById('propertyList').addEventListener('click',e=>{
    const c=e.target.closest('.card'); if(!c) return;
    openDetail(parseInt(c.dataset.id));
  });

  document.getElementById('backBtn').addEventListener('click',closeDetail);

  document.getElementById('editToggle').addEventListener('click',()=>{
    if(editing){ saveEdits(); }
    else { editing=true; const p=props.find(x=>x.id===editId); if(p) renderDetail(p);
      document.getElementById('editToggle').textContent='Save';
      document.getElementById('editToggle').className='edit-btn save';
    }
  });

  document.getElementById('detailBody').addEventListener('click',e=>{
    const cb=e.target.closest('.copy-btn');
    if(cb){ copyText(cb.dataset.copy,cb); return; }
    const ab=e.target.closest('.action-btn.archive');
    if(ab){ archiveProp(parseInt(ab.dataset.id)); return; }
    const rb=e.target.closest('.action-btn.restore');
    if(rb){ restoreProp(parseInt(rb.dataset.id)); return; }
    const db=e.target.closest('.action-btn.delete');
    if(db){ delProp(parseInt(db.dataset.id)); }
  });

  document.getElementById('addBtn').addEventListener('click',addProp);
  document.getElementById('exportBtn').addEventListener('click',()=>document.getElementById('exportModal').classList.add('open'));
  document.getElementById('exportJSON').addEventListener('click',exportJSON);
  document.getElementById('exportCSV').addEventListener('click',exportCSV);
  document.getElementById('exportCancel').addEventListener('click',closeModal);
  document.getElementById('exportModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) closeModal(); });

  let tx=0;
  const dv=document.getElementById('detailView');
  dv.addEventListener('touchstart',e=>{ tx=e.touches[0].clientX; },{passive:true});
  dv.addEventListener('touchend',e=>{ if(e.changedTouches[0].clientX-tx>80&&tx<60) closeDetail(); },{passive:true});
}

init();

</script>
</body>
</html>